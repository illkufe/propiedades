{% extends 'index.html' %}
{% block section %}

{% include 'partials/breadcrumbs-bar.html' %}

<div class="wrapper wrapper-content">
	<div class="row">
		<div class="col-lg-12">
			<div class="ibox float-e-margins">
				<div class="ibox-title">
					<h5>Nuevo Arriendo</h5>
				</div>
				<div class="ibox-content">
					<div class="row">
						<div class="col-sm-12">

							<form id="form-arriendo-new" role="form" action="" method="post">
								{% csrf_token %}

								{{ formset_detalle.management_form }}
								{% for form in formset_detalle %}
								{% for hidden in form.hidden_fields %}
								{{ hidden }}
								{% endfor %}
								{% endfor %}

								<table id="tabla-arriendo" class="table">
									<thead>
										{% for form in formset_detalle %}
										{% if forloop.first %}
										<th>
											<i class="fa fa-question-circle info-label" data-toggle="tooltip" data-placement="top" title="{{ form.mes_inicio.help_text }}" ></i>
											{{ form.mes_inicio.label_tag }}
										</th>
										<th>
											<i class="fa fa-question-circle info-label" data-toggle="tooltip" data-placement="top" title="{{ form.mes_termino.help_text }}" ></i>
											{{ form.mes_termino.label_tag }}
										</th>
										<th>
											<i class="fa fa-question-circle info-label" data-toggle="tooltip" data-placement="top" title="{{ form.valor.help_text }}" ></i>
											{{ form.valor.label_tag }}
										</th>
										<th>
											<i class="fa fa-question-circle info-label" data-toggle="tooltip" data-placement="top" title="{{ form.moneda.help_text }}" ></i>
											{{ form.moneda.label_tag }}
										</th>
										<th>
											<i class="fa fa-question-circle info-label" data-toggle="tooltip" data-placement="top" title="{{ form.metro_cuadrado.help_text }}" ></i>
											{{ form.metro_cuadrado.label_tag }}
										</th>

										<th>
											<i class="fa fa-question-circle info-label" data-toggle="tooltip" data-placement="top" title="eliminar" ></i>
											<label>ELiminar:</label>
										</th>
										{% endif %}
										{% endfor %}
									</thead>
									<tbody>
										{% for form in formset_detalle %}
										<tr>
											<td>

												<div class="form-group">
													{{ form.mes_inicio }}
													<div class="container-error" style="height:20px">
														{{ form.mes_inicio.errors }}
													</div>
												</div>
											</td>
											<td>

												<div class="form-group">
													{{ form.mes_termino }}
													<div class="container-error" style="height:20px">
														{{ form.mes_termino.errors }}
													</div>
												</div>
											</td>
											<td>

												<div class="form-group">

													{{ form.valor }}
													<div class="container-error" style="height:20px">
														{{ form.valor.errors }}
													</div>
												</div>
											</td>
											<td>

												<div class="form-group">

													{{ form.moneda }}
													<div class="container-error" style="height:20px">
														{{ form.moneda.errors }}
													</div>
												</div>
											</td>
											<td class="text-center">

												<div class="form-group">

													{{ form.metro_cuadrado }}
													<div class="container-error" style="height:20px">
														{{ form.metro_cuadrado.errors }}
													</div>
												</div>
											</td>
											<td class="text-center">

												<div class="form-group">

													{{ form.DELETE }}
												</div>
											</td>
										</tr>
										{% endfor %}
									</tbody>
								</table>


								<div class="row">

									<input type="hidden" id="id_contrato" name="contrato" value="{{contrato_id}}">

									<div class="form-group col-sm-2">
										<i class="fa fa-question-circle info-label" data-toggle="tooltip" data-placement="top" title="{{ form.reajuste.help_text }}" ></i>
										{{ form.reajuste.label_tag }}
										{{ form.reajuste }}
										<div class="container-error" style="height:20px">
											{{ form.reajuste.errors }}
										</div>
									</div>

									<div class="form-group col-sm-2">
										<i class="fa fa-question-circle info-label" data-toggle="tooltip" data-placement="top" title="{{ form.meses.help_text }}" ></i>
										{{ form.meses.label_tag }}
										{{ form.meses }}
										<div class="container-error" style="height:20px">
											{{ form.meses.errors }}
										</div>
									</div>

									<div class="form-group col-sm-2">
										<i class="fa fa-question-circle info-label" data-toggle="tooltip" data-placement="top" title="{{ form.valor.help_text }}" ></i>
										{{ form.valor.label_tag }}
										{{ form.valor }}
										<div class="container-error" style="height:20px">
											{{ form.valor.errors }}
										</div>
									</div>

									<div class="form-group col-sm-3">
										<i class="fa fa-question-circle info-label" data-toggle="tooltip" data-placement="top" title="{{ form.moneda.help_text }}" ></i>
										{{ form.moneda.label_tag }}
										{{ form.moneda }}
										<div class="container-error" style="height:20px">
											{{ form.moneda.errors }}
										</div>
									</div>

									<div class="form-group col-sm-3">
										<i class="fa fa-question-circle info-label" data-toggle="tooltip" data-placement="top" title="{{ form.fecha_inicio.help_text }}" ></i>
										{{ form.fecha_inicio.label_tag }}
										<div class="input-group date">
											{{ form.fecha_inicio }}
											<span class="input-group-addon">
												<i class="fa fa-calendar"></i>
											</span>
										</div>

										<div class="container-error" style="height:20px">
											{{ form.fecha_inicio.errors }}
										</div>
									</div>

								</div>

								<br>
								<button class="btn btn-w-m btn-sm btn-primary pull-right" type="submit">GUARDAR Y SALIR</button>
								<button class="btn btn-w-m btn-sm btn-primary pull-right" type="button" style="margin-right: 15px;" onclick="enviar_form('{{accion}}')">GUARDAR Y SEGUIR</button>
								<a href="/contratos-tipo/list">
									<button class="btn btn-w-m btn-sm btn-success pull-right" type="button" style="margin-right: 15px;">CANCELAR</button>
								</a>
							</form>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

{% endblock section %}

{% block scripts %}
<script>

$(document).ready(function(){
	var configuracion = {
		'order': false,
		'paginate': false,
		'bLengthChange': false,
		'bInfo': false,
		'buttons': [],
	} 


	var columns = [
	{
		'width': '15%',
		'orderable': false,
		'data': 'mes_inicio',
	},
	{
		'width': '15%',
		'orderable': false,
		'data': 'mes_termino',
	},
	{
		'width': '15%',
		'orderable': false,
		'data': 'valor',
	},
	{
		'width': '20%',
		'orderable': false,
		'data': 'moneda',
	},
	{
		'width': '15%',
		'orderable': false,
		'data': 'metros',
	},
	{
		'width': '10%',
		'orderable': false,
		'data': 'eliminar',
	}];

	var table = load_table('#tabla-arriendo', columns, configuracion)

});

function enviar_form(accion){
	$.ajax({
		type: 'post',
		url: $('#form-arriendo-new').attr('action'),
		data: $('#form-arriendo-new').serialize(),
		success: function(response) {

			if (accion == 'create') {
				clear_form('#form-arriendo-new')
			}
			clear_errors_form('#form-arriendo-new')

			notification_toast('success', 'Ã‰XITO', 'Guardado correctamente.')
		},
		error: function(data, textStatus, jqXHR) {

			clear_errors_form('#form-arriendo-new')

			var errors = $.parseJSON(data.responseText)
			apply_errors_form(errors)
		}
	});
	return false;
	
}

</script>
{% endblock scripts %}